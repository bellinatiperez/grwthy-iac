---
title: Webhook Events
description: Incoming message and status update events from WhatsApp
---

# Webhook Events

When Meta sends a webhook to `POST /whatsapp/webhook`, the payload is verified, parsed, and queued for processing. There are two event categories: **incoming messages** and **status updates**.

## Payload Structure

All webhook payloads follow the Meta Cloud API format:

```json
{
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "WABA_ID",
      "changes": [
        {
          "field": "messages",
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "5511999999999",
              "phone_number_id": "123456789012345"
            },
            "contacts": [
              {
                "profile": { "name": "John Doe" },
                "wa_id": "5511888888888"
              }
            ],
            "messages": [],
            "statuses": []
          }
        }
      ]
    }
  ]
}
```

## Incoming Messages

When a user sends a message to your WhatsApp number, the `messages` array contains the incoming message objects.

### Message Types

| Type | Description |
|------|-------------|
| `text` | Plain text message |
| `image` | Image with optional caption |
| `document` | Document file |
| `audio` | Audio message or voice note |
| `video` | Video with optional caption |
| `location` | Shared location |
| `contacts` | Shared contact cards |
| `interactive` | Button reply or list selection |
| `reaction` | Emoji reaction to a message |
| `sticker` | Sticker message |

### Example: Text Message

```json
{
  "messages": [
    {
      "id": "wamid.abc123",
      "from": "5511888888888",
      "timestamp": "1704067200",
      "type": "text",
      "text": {
        "body": "Hello!"
      }
    }
  ]
}
```

### Processing

Incoming messages are:

1. Queued in the `whatsapp-inbound` BullMQ queue
2. Logged in `message_logs` with direction `inbound` and status `received`
3. Emitted as internal event `webhook.message.received`

### Event Payload: `webhook.message.received`

```json
{
  "accountId": "account-uuid",
  "from": "5511888888888",
  "messageId": "wamid.abc123",
  "timestamp": "1704067200",
  "type": "text",
  "message": { "text": { "body": "Hello!" } },
  "contact": { "profile": { "name": "John Doe" }, "wa_id": "5511888888888" }
}
```

---

## Status Updates

When an outbound message changes status, the `statuses` array contains update objects.

### Status Flow

```
queued → sent → delivered → read
                    ↘
                   failed
```

| Status | Description |
|--------|-------------|
| `sent` | Message accepted by WhatsApp servers |
| `delivered` | Message delivered to recipient's device |
| `read` | Recipient opened the message |
| `failed` | Message could not be delivered |

### Example: Delivered Status

```json
{
  "statuses": [
    {
      "id": "wamid.abc123",
      "status": "delivered",
      "timestamp": "1704067260",
      "recipient_id": "5511888888888"
    }
  ]
}
```

### Example: Failed Status

```json
{
  "statuses": [
    {
      "id": "wamid.abc123",
      "status": "failed",
      "timestamp": "1704067260",
      "recipient_id": "5511888888888",
      "errors": [
        {
          "code": 131047,
          "title": "Re-engagement message",
          "message": "More than 24 hours have passed since the last message"
        }
      ]
    }
  ]
}
```

### Processing

Status updates are:

1. Queued in the `whatsapp-status` BullMQ queue
2. The corresponding `message_log` row is updated with the new status
3. Emitted as internal event `webhook.message.<status>`

### Internal Events

| Event | When |
|-------|------|
| `webhook.message.sent` | Message accepted by WhatsApp |
| `webhook.message.delivered` | Message arrived on recipient's device |
| `webhook.message.read` | Recipient read the message |
| `webhook.message.failed` | Delivery failed (includes `errors` array) |
